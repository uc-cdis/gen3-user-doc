<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="University of Chicago, CDIS">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Working with the API - Gen3 User Doc</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Working with the API";
    var mkdocs_page_input_path = "appendices/api-gen3.md";
    var mkdocs_page_url = "/appendices/api-gen3/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-27795084-5', 'mkdocs.org');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Gen3 User Doc</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">User Guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../user-guide/guide-overview/">Guide Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user-guide/data-contribution/">Data Contribution</a>
                </li>
                <li class="">
                    
    <a class="" href="../../user-guide/data-access/">Data Access</a>
                </li>
                <li class="">
                    
    <a class="" href="../data-dictionary/">Data Dictionary</a>
                </li>
                <li class="">
                    
    <a class="" href="../mtde/">Minimal Technical Data Elements</a>
                </li>
                <li class="">
                    
    <a class="" href="../proxy-whitelist/">Working with the Proxy and Whitelist</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Working with the API</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#working-with-the-api">Working with the API</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#what-does-the-api-do">What does the API do?</a></li>
        
            <li><a class="toctree-l4" href="#whats-an-example-of-the-api-at-work">What's an example of the API at work?</a></li>
        
            <li><a class="toctree-l4" href="#credentials-to-query-the-api">Credentials to query the API</a></li>
        
            <li><a class="toctree-l4" href="#queries-in-the-submission-portal-graphql">Queries in the submission portal:   graphQL</a></li>
        
            <li><a class="toctree-l4" href="#browsing-by-project-node">Browsing by project node</a></li>
        
            <li><a class="toctree-l4" href="#graphing-a-project">Graphing a project</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../template-tsvs/">Template TSVs</a>
                </li>
                <li class="">
                    
    <a class="" href="../architecture/">Data Commons Architecture</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../user-guide/demo/">DEMO</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Gen3 User Doc</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>User Guide &raquo;</li>
        
      
    
    <li>Working with the API</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="working-with-the-api">Working with the API<a class="headerlink" href="#working-with-the-api" title="Permanent link"></a></h1>
<hr />
<h2 id="what-does-the-api-do">What does the API do?<a class="headerlink" href="#what-does-the-api-do" title="Permanent link"></a></h2>
<p>The API is created programmatically based on the <a href="https://github.com/occ-data/datadictionary">Gen3 commons data model</a>.   All of the work Gen3 data contributors do to prepare their metadata powers the API (see steps <a href="../../user-guide/data-contribution/#4-prepare-metadata-that-fits-the-data-model">4-6 in the Data Contribution section</a>).   </p>
<p>With the API in place, users can submit queries to find whatever metadata information they might like across the Gen3 commons.   The API can be queried programmatically or through provided tools like the submission portal.  </p>
<p>We use <a href="http://graphql.org/">GraphQL</a> to manage the metadata in the Gen3 commons.  To learn the basics of writing queries in Graph QL, we recommend <a href="http://graphql.org/learn/">this introduction</a>.</p>
<h2 id="whats-an-example-of-the-api-at-work">What's an example of the API at work?<a class="headerlink" href="#whats-an-example-of-the-api-at-work" title="Permanent link"></a></h2>
<p>The Gen3 commons team has created a few matrices to help describe submitted data.   These are linked to from: <a href="https://www.gen3.org/data-group/">https://www.gen3.org/data-group/</a></p>
<p>These query the API for the desired metadata and return the matrices.   They run on cron jobs that update hourly, so if you're submitting data or adding to the commons, you can watch your entry appear.   If you are a member and would like to view these matrices, contact info@gen3.org for a username and password.   </p>
<h2 id="credentials-to-query-the-api">Credentials to query the API<a class="headerlink" href="#credentials-to-query-the-api" title="Permanent link"></a></h2>
<p>Like your credentials that let you access "raw" data in the object store or your ssh keys that let you access a VM, there is also a credential that lets you programmatically query or submit data to the API. This credential is used every time you make an API call.</p>
<p>Each API key is valid for a month and is used to receive a temporary access token that is valid for only 30 minutes. The access token is what must be sent to the Gen3 API to access data in the commons.</p>
<p>For users granted data access, the API key is provided on your Profile page when you click "Create API key".
<img alt="Profile Page" src="../../img/profile-page.png" /></p>
<p>While displayed, you can click "copy" to copy the API key to your clipboard or "download" to download a "credentials.json" file containing the id/key pair in json format.
<img alt="Copy Key" src="../../img/copy-keys.png" /></p>
<p>In python, the following command is sent, using the module "requests", to receive the access token:</p>
<pre><code># Save your copied credentials.json from the website into a variable &quot;key&quot;:
key =  { &quot;api_key&quot;: &quot;&lt;actual-key&gt;&quot;, &quot;key_id&quot;: &quot;&lt;a-key-uuid&gt;&quot; }

# Import the &quot;requests&quot; python module:
import requests

# Pass the API key to the Gen3 API using &quot;requests.post&quot; to receive the access token:
t = requests.post('https://gen3.kids-first.io/user/credentials/cdis/access_token', json=key)

# Now you should see your access_token displayed when you enter:
t.json()

</code></pre>

<p>When submitting a graphQL query to the Gen3 API, or requesting data download/upload, include the access token in your request:</p>
<pre><code># a graphQL endpoint query using the &quot;key&quot; json:
query = {'query':&quot;&quot;&quot;{case{submitter_id}}&quot;&quot;&quot;};
output = requests.post('https://gen3.commons.io/api/v0/submission/graphql/', auth=t.json()['access_token'], json=query).text

# Data download via API endpoint request:
r = requests.get('https://gen3.commons.io/user/data/download/file-uuid', headers={'Authorization': 'bearer '+ t.json()['access_token']})

# Data upload via API endpoint request:
u = requests.put('https://gen3.commons.io/api/v0/submission/project-id', data=tsv, headers={'content-type': 'text/tab-separated-values', 'Authorization': 'bearer '+ t.json()['access_token']})
</code></pre>

<p>If you receive an error like "You don't have access... ", then you will most likely need to update your API key or request a new access token.</p>
<h2 id="queries-in-the-submission-portal-graphql">Queries in the submission portal:   graphQL<a class="headerlink" href="#queries-in-the-submission-portal-graphql" title="Permanent link"></a></h2>
<p>You can run queries directly in the submission portal by clicking the "Query" magnifying glass or directly at: <a href="https://data.gen3.org/graphql">https://data.gen3.org/graphql</a>. Queries are essential as you begin analyses. The query portal has been optimized to autocomplete fields based on content, increase speed and responsiveness, and generally make it easier for Gen3 members to find what they need.</p>
<p><img alt="GraphQL Query" src="../../img/gQL-query.gif" /></p>
<h3 id="pagination-and-offsets-default-first-10-entries">Pagination and Offsets:   Default = first 10 entries<a class="headerlink" href="#pagination-and-offsets-default-first-10-entries" title="Permanent link"></a></h3>
<p>Queries by defult return the first 10 entries. If you want more than that, you can specify it in the query call: <code>(first:1000)</code></p>
<p>In the case that too many results are returned, you may receive a timeout error. In that case, you may want to use <a href="http://graphql.org/learn/pagination/">pagination</a>. For example, if there are 2,550 records returned, and your graphiQL query is timing out with <code>(first:3000)</code>, then break your query into multiple queries with offsets:</p>
<pre><code>(first:1000, offset:0)      # this will return records 0-1000
(first:1000, offset:1000)   # this will return records 1000-2000
(first:1000, offset:2000)   # this will return records 2000-2,550
</code></pre>

<p>Updating the example template <a href="../../assets/details_from_experiment.json"><code>details from experiment</code></a> sample query to call the first 1000, the call becomes:  </p>
<pre><code>{
    &quot;query&quot;:&quot; query Test {
        experiment (first:1000, submitter_id: &quot;&lt;INSERT submitter_id&gt;&quot;) {  
            experimental_intent
            experimental_description
            number_samples_per_experimental_group
            type_of_sample
            type_of_specimen
        }
    } &quot;
}
</code></pre>

<h2 id="browsing-by-project-node">Browsing by project node<a class="headerlink" href="#browsing-by-project-node" title="Permanent link"></a></h2>
<p>The metadata submission portal <a href="https://data.gen3.org/">https://data.gen3.org/</a> can be used to browse an individual submission by node.   Just select a project and then click the "browse nodes" button to the right.    From there, you'll get a screen like below where you can query by node in the dropdown at the left.</p>
<h4> Example:  Browse by node </h4>

<p><img alt="Browse by node" src="../../img/browse-by-node.png" /></p>
<p>You can also use this feature to download the tsv associated with the node, or if you have "write" access to the this project, delete existing nodes.   </p>
<h2 id="graphing-a-project">Graphing a project<a class="headerlink" href="#graphing-a-project" title="Permanent link"></a></h2>
<p>You can also review a graph of an individual project, toggling between views of the completed nodes and the full graph.  </p>
<h5> Example:  Graphing a project </h5>

<p><img alt="Graphing a project" src="../../img/graph-a-project.gif" /></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../template-tsvs/" class="btn btn-neutral float-right" title="Template TSVs">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../proxy-whitelist/" class="btn btn-neutral" title="Working with the Proxy and Whitelist"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2017 <a href="https://cdis.uchicago.edu">CDIS at UChicago</a></p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/uc-cdis/gen3-user-doc/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../proxy-whitelist/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../template-tsvs/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/require.js"></script>
      <script src="../../search/search.js"></script>

</body>
</html>
